<?php//// Модель для работы с товарами.//class M_Items{	private $item_id;	private $item_title;    private $item_desc;    private $item_img;    private $item_date;	// Ссылка на экземпляр класса.	private static $instance;	private $msql;		// Получение единственного экземпляра.	public static function instance()	{		if (self::$instance == null)			self::$instance = new M_Items;				return self::$instance;	}		public function __construct()	{		$this->msql = M_MSQL::instance();	}				//	// Список всех товаров в подкатегории.	//	public function all($subcat_id)	{		// Подготовка.		$subcat_id = intval($subcat_id);				// Запрос.		$query = "SELECT * FROM items WHERE subcat_id = '$subcat_id'";				$items = $this->msql->Select($query);			return $items;	}		//	// Список всех товаров в подкатегории постранично.	//	public function allPaged($subcat_id, $on_page)	{		// Подготовка.		if ($subcat_id)			$subcat_id = intval($subcat_id);		else			$subcat_id = 1;				$all = count($this->all($subcat_id));		if (!$all)			return false;					// Количество записей на страницу   		$all_page = ceil($all/$on_page);  		$this_page = (isset($_GET['page'])) ? intval($_GET['page']) : 1 ;  		if ($this_page < 1 || $this_page > $all_page) $this_page = 1;  		$start = $this_page * $on_page - $on_page;						// Запрос.		$query = "SELECT * FROM items				  WHERE subcat_id = '$subcat_id'				  LIMIT $start, $on_page";				$items = $this->msql->Select($query);		$pagination = $this->pagination($all_page, '?act=index&subcat='.$subcat_id.'&page={p}', 1, 1);			$items_arr = array();		$items_arr[] = $items;		$items_arr[] = $pagination;			return $items_arr;	}	//	// Конкретный товар.	//	/*	public function get()	{		// Подготовка.		$subcat_id = intval($subcat_id);				// Запрос.		$result = "SELECT * FROM items WHERE subcat_id = '$subcat_id'";		return $this->msql->Select($result);	}	*/		//	// Добавить товар.	//	public function add($category, $title, $desc, $img = array())        {                    }	//	// Изменить товар	//	//public function edit($id_article, $title, $content)	//	// Удалить товар	//	//public function delete($id_article)		/*	function image_upload()	{		$ds = DIRECTORY_SEPARATOR;  //1		$storeFolder = 'uploads';   //2		if (!empty($_FILES))			{				$tempFile = $_FILES['file']['tmp_name'];          //3             				$targetPath = dirname( __FILE__ ) . $ds. $storeFolder . $ds;  //4				$targetFile =  $targetPath. $_FILES['file']['name'];  //5				move_uploaded_file($tempFile,$targetFile); //6			}	}	*/		public function pagination($allpage, $query, $flp, $expanded)  	{  		// {p} в $query заменяется на номер страницы, пример index.php?p={p}  		// $flp - вывод первой и последней страницы  		// $expanded - расширенная навигация  		$this_page = (isset($_GET['page'])) ? intval($_GET['page']) : 1 ;  		if($this_page < 1 || $this_page > $allpage)$this_page = 1;  		$prev_page = $this_page - 1;  		$pprev_page = $this_page - 2;  		$next_page = $this_page + 1;  		$nnext_page = $this_page + 2;  		$var = ($prev_page < 1) ? "" : "<td><a href='".str_replace('{p}',$prev_page,$query)."'><img src='images/lt.png'></a></td> ";  		// Первая страница  		if ($this_page > 2 && $flp == 1) $var .= "<td><a href='".str_replace('{p}',1,$query)."'>1</a> ... </td>";  		// Пред предыдущая страница  		if ($pprev_page > 1 && $expanded == 1) $var .= "<td><a href='".str_replace('{p}',$pprev_page,$query)."'>$pprev_page</a></td> ";  		// Предыдущая страница  		$var .= ($prev_page < 1) ? "" : "<td><a href='".str_replace('{p}',$prev_page,$query)."'>$prev_page</a></td> ";  		// Наша позиция  		$var .= ($allpage == 1) ? "" : "<td><strong>$this_page</strong></td>";  		// Следующая страница  		$var .= ($next_page > $allpage) ? "" : " <td><a href='".str_replace('{p}',$next_page,$query)."'>$next_page</a></td>";  		// Следующая за следующей страница  		if ($nnext_page < $allpage && $expanded == 1) $var .= " <td><a href='".str_replace('{p}',$nnext_page,$query)."'>$nnext_page</a></td>";  		//Последняя страница  		if ($this_page < $allpage - 1 && $flp == 1) $var .= "<td> ... <a href='".str_replace('{p}',$allpage,$query)."'>$allpage</a></td>";  		$var .= ($next_page > $allpage) ? "<td width='36px'></td>" : " <td><a href='".str_replace('{p}',$next_page,$query)."'><img src='images/rt.png'></a></td>";  		return $var;	}  }